<!-- 
** auth：    照相 393727164@qq.com  
** date：    2017/6/19 23:12:01
** desc：    因为之前写过C#版本的，因此这里没有再通过网络获取数据了，而且也有水平所限还有懒的缘故，但是也省去了不必要的加载时间，数据都是从Windows版本将需要的信息以一定的规范保留在本地以后以String的方式复制粘贴存储在js文件中，
             若有任何意见或建议，可以联系照相，QQ：393727164，或是加入2017福建农林大学新生群：451362594。
             本页面数据来自福建农林大学招生办和招生咨询网，还有群里的小伙伴整理而得，由照相整理，引用请注明出处！！
             ps:初学H5，不足之处望见谅。
** Ver.:     V1.0.0
Copyright (c) 2017年 照相. All rights reserved.
-->
<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>2017FAFU新生报考信息查询</title>
    <style>
        body,
        html {
            padding: 0;
            margin: 0;
            height: 100%;
            user-select: none;
            background-color: lightskyblue;
        }

        h1 {
            margin-top: 20px;
            text-align: center;
            font-size: 25px;
            color: red;
        }

        .p1 {
            text-align: center;
            font-size: 20px;
            vertical-align: center;
        }

        .p1 select {
            font-size: 18px;
            margin-right: 60px;
            margin-left: 10px;
            border: 1px solid blue;
        }

        .p1 input {
            font-size: 18px;
            margin-right: 60px;
            margin-left: 10px;
            border: 1px solid blue;
        }

        .p2 {
            text-align: center;
            margin-top: 20px;
        }

        .p2 input {
            width: 100px;
        }

        #submitBtn {
            border-radius: 5px;
            width: 15%;
            background-color: white;
        }

        footer {
            height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 12px;
            background-color: transparent;
            border-top: 1px solid lightgray;
            color: gray;
        }

        @media screen and (max-width: 750px) {
            /*基本适配*/
            .p1 select {
                font-size: 12px;
                margin-right: 20px;
                margin-left: 10px;
                width: 60px;
            }
            .p1 input {
                font-size: 12px;
                margin-right: 20px;
                margin-left: 10px;
                width: 60px;
            }
            .p1 {
                font-size: 12px;
            }
            h1 {
                font-size: 20px;
            }
            footer {
                height: 90px;
                font-size: 6px;
                
            }
        }
    </style>
</head>

<body>

    <h1>2017FAFU新生报考信息查询</h1>
    <main>
        <section class="p1">省份:<select id="selP"></select>文理:<select><option value="">理工</option><option value="">文史</option><option value="">艺术类</option></select>专业:
            <input id="selM" type="text" placeholder="请输入专业">
            <section class="p2"><input id="submitBtn" type="submit" value="查询"></section>
            <section class="p3">
                <hr>
                <a style="color:blue;font-size:15px" href="https://pan.baidu.com/s/1geSDq2R" target="_blank">点击此处下载校区详情和宿舍安排与宿舍环境介绍文件</a>
            </section>
    </main>
    <footer>
        <div>Copyright (c) 2017年 照相. All rights reserved.</div>
        <div>QQ:393727164</div>
        <div>1.数据来源:福建农林大学招生办,学科资讯网,老陈整理的农大宿舍环境介绍 (2017) .docx； 特此鸣谢</div>
        <div>2.注意事项:专业往年录取情况分数线信息以2016年本校在各个省份的录取结果为数据来源，结果仅供参考,一切以你们发的招生简章和学校的说明文件为准,保留更改的权利。</div>
        <div>3.免责说明:因信息量过于庞大，纰漏之处在所难免，因此本程序的所有结果仅供参考，有任何疑问可以在群里提问，请仔细查阅发放的招生简章等报考书籍，若数据有出入，以该书中内容为准，您也可以联系我们进行数据的更改,感谢您的理解和支持!</div>
        <div onclick="window.location='http://shang.qq.com/wpa/qunwpa?idkey=c5fcd6363cc0e2eb8e2da66abc8230a61d0253a096481589725711dff79e3e4f'">4.如有任何疑问，欢迎加入2017福建农林大学新生群：<span style="color:red">451362594(点击此处直接加入本群) </span></div>
    </footer>
    <!--引入所有数据-->
    <script src="http://zxlee.oss-cn-shanghai.aliyuncs.com/datas.js"></script>
    <script>
        var selP = document.getElementById('selP');//省份
        var selM = document.getElementById('selM');//专业
        var submitBtn = document.getElementById('submitBtn');//查询按钮
        var p3 = document.querySelector('.p3');//显示结果的section
        //初始化页面
        var main = document.querySelector('main');
        var footer = document.querySelector('footer');
        footer.style.marginTop = window.innerHeight - main.offsetHeight - footer.offsetHeight * 1.5 + 'px';
        //初始化数据
        var preJson = JSON.parse(localStorage.getItem('pre'));
        if (preJson != null)
            selM.value = preJson.m;
        //初始化省份select
        var thArr = ['省份', '专业', '所属学院', '批次', '类别', '录取最低分', '录取平均分', '录取最高分', '就读校区'];//table的标题数组
        for (var i = 0; i < provinces.split('*').length; i++) {
            selP.innerHTML += `<option>${provinces.split('*')[i]}</option>`;
        }
        p3.style.marginTop = '20px';
        selM.onkeydown = function(e){//为专业输入标签添加键盘点击事件
            if(e.keyCode == 13){//点击了回车
                submitBtn.onclick();//执行查询命令
            }
        }
        submitBtn.onclick = function () {//点击了查询按钮 
            //清除当前页面所有的title
            var titles = document.querySelectorAll('h2');
            titles.forEach(function (item) {
                item.parentNode.removeChild(item);
            }, this);
            //清除当前页面的所有table
            var tables = document.querySelectorAll('table');
            tables.forEach(function (item) {
                item.parentNode.removeChild(item);
            }, this);
            //本地存储查询该条查询记录，以便下次访问时无需重新填写
            if (!navigator.userAgent.match(/(iPhone|iPod|iPad|ios|Android)/i)) {//若非移动端，其他移动端设备忽略
                var pre = {
                    p: selP.value,
                    m: selM.value
                }
                try{//若发生异常，则忽略
                    localStorage.setItem("pre", JSON.stringify(pre));
                }catch(err){

                }
                
            }

           
            for (var i = 0; i < data.split('@').length - 2; i++) {//遍历所有数据
                var singleData = data.split('@')[i].split('*');//单条数据
                if (selM.value == "") {//专业为空，返回
                    footer.style.marginTop = window.innerHeight - main.offsetHeight - footer.offsetHeight * 1.5 + 'px';
                    alert('专业不能为空！请重新输入');
                    selM.focus();
                    return;
                }
                var p = selP.value.trim();//临时存储省份信息
                if (p == "全国") p = "";//若是全国，即为所有省份
                if (singleData.length < 5) return;
                if (singleData[1].indexOf(p) >= 0) {//若有查询结果
                    var cArr = selM.value.split('');
                    var majorCheckFlag = true;//用以筛选专业
                    cArr.forEach(function (item, index) {//输入的专业所有字符包含在专业全称里面即可
                        if (singleData[4].indexOf(item) < 0) {
                            majorCheckFlag = false;
                        }
                    }, this);
                    if (majorCheckFlag == false) continue;//若不匹配，跳过本次循环
                    var title = document.createElement('h2');//专业查询结果标题
                    title.style.color = 'red';
                    title.innerText = singleData[4];
                    title.onclick = function () {
                        var opened = false;//验证是否打开了专业介绍
                        majors.split('*').forEach(function (item, index) {
                            if (item.trim() == this.innerText.replace('(点击查看专业介绍)', '').trim()) {
                                window.open(urls.split('*')[index].substring(1, urls.split('*')[index].length - 1));
                                opened = true;
                            }
                        }, this);
                        if (opened == false) {//若没有打开专业介绍
                            alert('很抱歉，暂无此专业的专业介绍哦');
                        }
                    }
                    var sub = document.createElement('sub');
                    sub.innerText = "(点击查看专业介绍)";
                    sub.style.fontSize = '10px';
                    title.appendChild(sub);//添加下标
                    var table = document.createElement('table');
                    //设置table的样式
                    table.width = '100%';
                    table.border = '1';
                    table.style.textAlign = 'center';
                    table.style = 'border-collapse:collapse';
                    var tr1 = table.insertRow();
                    tr1.style.fontSize = '900';
                    //添加标题
                    thArr.forEach(function (item) {
                        var th = tr1.insertCell();
                        th.innerText = item;
                        th.style.textAlign = 'center';
                    }, this);
                    var tr2 = table.insertRow();
                    //学院和校区单独出来设置
                    var pro = tr2.insertCell();//省份
                    pro.innerText = singleData[1];
                    var major = tr2.insertCell();//专业
                    major.innerText = singleData[4];
                    var college = tr2.insertCell();//学院
                    college.innerText = '没有信息';
                    var pici = tr2.insertCell();//批次
                    pici.innerText = singleData[2];
                    var leibie = tr2.insertCell();//类别
                    leibie.innerText = singleData[3];
                    var minScore = tr2.insertCell();//最低
                    minScore.innerText = singleData[5];
                    var aveScore = tr2.insertCell();//平均
                    aveScore.innerText = singleData[7];
                    var maxScore = tr2.insertCell();//最高
                    maxScore.innerText = singleData[6];
                    var area = tr2.insertCell();//校区
                    area.innerText = '没有信息';
                    //设置学院和校区的信息
                    //设置学院信息
                    majors.split('*').forEach(function (item, index) {
                        if (major.innerText == item) {
                            college.innerText = colleges.split('*')[index];
                        }
                    }, this);
                    if (major.innerText.indexOf('茶学院') >= 0) {//此时学院必为安溪茶学院
                        college.innerText = '安溪茶学院';
                    }
                    if (college.innerText.indexOf('没有信息') < 0) {
                        var sub = document.createElement('sub');
                        sub.innerText = "(点击查看学院招生办电话)";
                        sub.style.fontSize = '10px';
                        sub.style.color = 'orangered';
                        college.appendChild(sub);//添加下标
                    }
                    college.onclick = function () {//点击了所属学院
                        var alerted = false;
                        phones.split('@').forEach(function (item, index) {
                            if (item.split('*')[0] == this.innerText.replace('(点击查看学院招生办电话)', '')) {
                                alert(item.split('*')[0] + "的招生办电话为：" + item.split('*')[1]);
                                alerted = true;
                            }
                        }, this);
                        if (alerted == false) {
                            alert('很抱歉，暂时没有查找到这个学院的招生办电话哦');
                        }
                    }
                    //设置校区信息
                    areas.split('@').forEach(function (item, index) {
                        if (item.split('*')[0] == major.innerText) {
                            area.innerText = item.split('*')[1];
                        }
                    }, this);
                    if (major.innerText.indexOf('茶学院') >= 0) {//此时学院必为安溪茶学院
                        area.innerText = '第一年在福州金山校区就读后三年在安溪茶学院校区就读';
                    }
                    //设置校区详情
                    var areaStr = area.innerText;
                    //额外设置area标签的HTML
                    areaStr = areaStr.replace('安溪茶学院校区', '<a style="color:orangered;text-decoration:none" href="http://ditu.amap.com/search?id=B0FFF9OMR6&city=350524&geoobj=118.120797%7C24.545507%7C118.131097%7C24.551088&query_type=IDQ&query=%E7%A6%8F%E5%BB%BA%E5%86%9C%E6%9E%97%E5%A4%A7%E5%AD%A6%E5%AE%89%E6%BA%AA%E8%8C%B6%E5%AD%A6%E9%99%A2&zoom=17" target="_blank">安溪茶学院校区</a>');
                    areaStr = areaStr.replace('福州金山校区', '<a style="color:orangered;text-decoration:none" href="http://ditu.amap.com/search?id=B024F05EZH&city=350104&geoobj=118.223563%7C25.073902%7C118.244162%7C25.085018&query_type=IDQ&query=%E7%A6%8F%E5%BB%BA%E5%86%9C%E6%9E%97%E5%A4%A7%E5%AD%A6(%E9%87%91%E5%B1%B1%E6%A0%A1%E5%8C%BA)&zoom=16" target="_blank">福州金山校区</a>');
                    areaStr = areaStr.replace('福州大学城旗山校区', '<a style="color:orangered;text-decoration:none" href="http://ditu.amap.com/search?id=B0FFH985R0&city=350121&geoobj=119.216732%7C26.071792%7C119.257931%7C26.09384&query_type=IDQ&query=%E7%A6%8F%E5%BB%BA%E5%86%9C%E6%9E%97%E5%A4%A7%E5%AD%A6(%E6%97%97%E5%B1%B1%E6%A0%A1%E5%8C%BA)&zoom=15" target="_blank">福州大学城旗山校区</a>');
                    area.innerHTML = areaStr;//覆盖标签area的HTML
                    //与本省的高考分数线进行比较，取差值
                    var myScores = scores.split('@');
                    myScores.forEach(function (item, index) {
                        if (leibie.innerText == "理工") {//理工类
                            setScore(pro, pici, minScore, aveScore, maxScore, item, 2);
                        } else if (leibie.innerText == "文史") {//文史类
                            setScore(pro, pici, minScore, aveScore, maxScore, item, 1);
                        } else {//艺术类，不作处理

                        }
                    }, this);
                    p3.appendChild(title);
                    p3.appendChild(table);

                }
            }
            //遍历结束
            //刷新页面布局
            footer.style.marginTop = window.innerHeight - main.offsetHeight - footer.offsetHeight * 1.5 + 'px';
            if (main.offsetHeight > window.innerHeight - footer.offsetHeight - 60) {
                footer.style.marginTop = '70px';
            }else{
                footer.style.marginTop = window.innerHeight - main.offsetHeight - footer.offsetHeight * 1.5 + 'px';
            }
            //结果处理
            if (document.querySelectorAll('table').length == 0) {//若未查询到任何信息
                footer.style.marginTop = window.innerHeight - main.offsetHeight - footer.offsetHeight * 1.5 + 'px';
                alert('未查询到任何信息，请检查您的输入！');
            }
        }
        function setScore(pro, pici, min, ave, max, s, index1) {//设置与本省的高考分数线的分数差，pro：所在省份；pici：批次；min，ave，max：最低，平均，最高分数；s：单行score；index1：索引位置
            if (pro.innerText.indexOf(s.split(' ')[0]) >= 0) {
                //var rep = index1 == 2 ? '理科' : '文科';//区分文理科
                if (pici.innerText.indexOf('本科一批') >= 0 || pici.innerText.indexOf('本科提前一批定向') >= 0) {//本科一批
                    tempFun('(高于本省一本线');
                } else if (pici.innerText.indexOf('本科二批') >= 0) {//本科二批
                    tempFun('(高于本省二本线');
                } else {//其他 不作处理

                }
                function tempFun(ss) {//计算并且设置数据
                    var score = 0;
                    score = ss == '(高于本省一本线' ? Math.round(s.split(' ')[index1].match(/[/^(\d)*$]/g).join('')):Math.round(s.split(' ')[index1 + 2].match(/[/^(\d)*$]/g).join(''));
                   // console.log(score);
                    min.innerText += ss + (Math.round(min.innerText) - score) + '分)';
                    ave.innerText += ss + (Math.round(ave.innerText) - score) + '分)';
                    max.innerText += ss + (Math.round(max.innerText) - score) + '分)';
                }
            }
        }
        window.onresize = function () {
            //刷新页面布局
            footer.style.marginTop = window.innerHeight - main.offsetHeight - footer.offsetHeight * 1.5 + 'px';
            if (main.offsetHeight > window.innerHeight - footer.offsetHeight - 60) {
                footer.style.marginTop = '70px';
            }else{
                footer.style.marginTop = window.innerHeight - main.offsetHeight - footer.offsetHeight * 1.5 + 'px';
            }
        }
    </script>
</body>

</html>
